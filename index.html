<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refresh MAC Tool</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold mb-4">Refresh MAC Tool</h1>
        <form id="url-form">
            <div class="flex mb-4">
                <label for="original-url" class="w-1/3 text-right mr-2">Original URL:</label>
                <input type="text" id="original-url" name="original-url"
                    class="flex-grow rounded-md border border-gray-300 px-2 py-1">
            </div>
            <div class="flex mb-4">
                <label for="new-mac" class="w-1/3 text-right mr-2">New Device MAC:</label>
                <input type="text" id="new-mac" name="new-mac"
                    class="flex-grow rounded-md border border-gray-300 px-2 py-1">
            </div>
            <button type="button" id="refresh-button"
                class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-700">Update MAC</button>
            <button type="button" id="regen-button"
                class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-700">Regenerate MAC</button>
        </form>
        <div id="updated-url" class="mt-4 text-blue-500 underline"></div>
        <button type="button" id="copy-button"
            class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-700">Copy URL</button>

    </div>

    <script>
        function autoUpdateDeviceMac(url) {
            // Create a URL object
            const parsedUrl = new URL(url);

            // Check if mac_address parameter exists (decodeURIComponent for handling %)
            if (parsedUrl.searchParams.has('mac_address')) {
                // Extract the existing mac_address
                const currentMac = decodeURIComponent(parsedUrl.searchParams.get('mac_address'));

                // Split the mac address into octets
                const macOctets = currentMac.split(':');
                console.log(macOctets)
                const validOctets = macOctets.length > 6 ? macOctets.slice(0, 3) : macOctets;

                // Randomize the last three octets (ensure they stay valid hex values)
                for (let i = 3; i < 6; i++) {
                    validOctets[i] = Math.floor(Math.random() * 16).toString(16).padStart(2, '0');
                }

                // Rebuild the new mac address
                const newMac = validOctets.join(':');

                // Update mac_address parameter
                parsedUrl.searchParams.set('mac_address', newMac);

                // Return the updated URL
                return parsedUrl.toString();
            } else {
                // mac_address not found, return original URL
                return url;
            }
        }

        const updateDeviceMac = function (url, newMac) {
            // Your updated JavaScript code from previous response
            // Create a URL object
            const parsedUrl = new URL(url);

            // Check if mac_address parameter exists (decodeURIComponent for handling %)
            if (parsedUrl.searchParams.has('mac_address')) {
                // Validate newMac format (6 octets separated by colons)
                const macRegex = /^([0-9A-F]{2}:){5}[0-9A-F]{2}$/i;
                if (!macRegex.test(newMac)) {
                    throw new Error('Invalid new mac_address format. Must be 6 octets separated by colons (e.g., FF:AA:BB:CC:DD:EE)');
                }

                // Decode the existing mac_address parameter value (if needed)
                const currentMac = decodeURIComponent(parsedUrl.searchParams.get('mac_address'));

                // Update mac_address parameter
                parsedUrl.searchParams.set('mac_address', newMac);

                // Return the updated URL
                return parsedUrl.toString();
            } else {
                // mac_address not found, return original URL
                return url;
            }
        };

        const refreshButton = document.getElementById('refresh-button');
        const regenButton = document.getElementById('regen-button');
        const updatedUrl = document.getElementById('updated-url');

        regenButton.addEventListener('click', function () {
            const originalUrl = document.getElementById('original-url').value;
            try {
                const updatedURL = autoUpdateDeviceMac(originalUrl);
                updatedUrl.textContent = `${updatedURL}`;
            } catch (error) {
                console.error(error.message);
                updatedUrl.textContent = `Error: ${error.message}`;
            }
        });

        refreshButton.addEventListener('click', function () {
            const originalUrl = document.getElementById('original-url').value;
            const newMac = document.getElementById('new-mac').value;

            try {
                const updatedURL = updateDeviceMac(originalUrl, newMac);
                updatedUrl.textContent = `${updatedURL}`;
            } catch (error) {
                console.error(error.message);
                updatedUrl.textContent = `Error: ${error.message}`;
            }
        });

        const copyButton = document.getElementById('copy-button');

        copyButton.addEventListener('click', function () {
            if (navigator.clipboard) {
                // Use Clipboard API if available
                navigator.clipboard.writeText(updatedUrl);
            } else {
                // Use fallback method
                copyToClipboard(updatedUrl);
            }
        });
    </script>
</body>

</html>